<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LifeDrop â€” Register / Login</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#e9d8fd">

  <style>
    body { position: relative; overflow: hidden; }
    .bg-slideshow { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .bg-slideshow img {
      position:absolute; width:100%; height:100%;
      object-fit:cover; opacity:0; transition:opacity 2s ease-in-out;
    }
    .bg-slideshow img.active { opacity:1; }

    .heading {
      font-family: 'Dancing Script', cursive;
      font-size: 3rem; /* larger size */
      color: #4c1d95;
      text-shadow: 1px 1px 6px rgba(0,0,0,0.3);
      animation: fadeSlide 1.5s ease forwards;
    }
    @keyframes fadeSlide {
      from { opacity:0; transform:translateY(-20px); }
      to { opacity:1; transform:translateY(0); }
    }
    .btn-animate {
      transition: transform 0.3s ease, background-color 0.3s ease;
    }
    .btn-animate:hover { transform:scale(1.05); background-color:#34d399; }
    input:focus, select:focus {
      outline:none; border-color:#60a5fa; box-shadow:0 0 6px #60a5fa;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 space-y-6">

  <!-- Background Slideshow -->
  <div class="bg-slideshow">
    <img src="pexels-skip-class-210143240-13548724.jpg" class="active">
    <img src="pexels-carloscruz-artegrafia-172084181-11198237.jpg">
    <img src="pexels-shvetsa-6291080.jpg">
    <img src="pexels-skip-class-210143240-13548724.jpg">
    <img src="pexels-carloscruz-artegrafia-172084181-11198237.jpg">
  </div>

  <!-- Heading Above Box -->
  <h1 class="heading text-center">Welcome to LifeDrop</h1>

  <!-- Main Box -->
  <div class="w-full max-w-2xl bg-white/90 rounded-2xl shadow-2xl p-6 backdrop-blur-sm">
    <!-- REGISTER FORM -->
    <form id="register-form" class="space-y-3">
      <h2 class="text-xl font-bold">Create an account</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <input id="register-name" required placeholder="Full name" class="p-2 border rounded" />
        <input id="register-contact" required placeholder="Contact (used as ID)" class="p-2 border rounded" />
        <input id="register-email" placeholder="Email (optional)" class="p-2 border rounded" />
        <select id="register-type" class="p-2 border rounded" required>
          <option value="">I am a...</option>
          <option value="donor">Donor</option>
          <option value="taker">Need Blood</option>
        </select>
        <select id="register-blood" class="p-2 border rounded" required>
          <option value="">Blood group</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
        <select id="register-gender" class="p-2 border rounded">
          <option value="">Gender (optional)</option>
          <option>Male</option><option>Female</option><option>Other</option>
        </select>
        <input id="register-dob" type="date" class="p-2 border rounded" />
        <select id="register-state" class="p-2 border rounded" required>
          <option value="">Select state</option>
        </select>
        <select id="register-district" class="p-2 border rounded" required>
          <option value="">Select district</option>
        </select>
      </div>
      <div>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded btn-animate">Register & Continue</button>
        <button id="to-login" type="button" class="bg-gray-100 px-4 py-2 rounded btn-animate ml-2">Already have an account?</button>
      </div>
    </form>

    <!-- LOGIN FORM -->
    <form id="login-form" class="space-y-3 hidden">
      <h2 class="text-xl font-bold">Sign in</h2>
      <input id="login-contact" placeholder="Contact (the number you registered with)" class="p-2 border rounded w-full" />
      <div>
        <button class="bg-green-500 text-white px-4 py-2 rounded btn-animate" type="submit">Login</button>
        <button id="to-register" type="button" class="bg-gray-100 px-4 py-2 rounded btn-animate ml-2">Register instead</button>
      </div>
    </form>
  </div>

  <!-- Buttons Below Box -->
  <div class="flex gap-4">
    <button id="show-register" class="py-2 px-6 bg-teal-500 text-white rounded btn-animate">Register</button>
    <button id="show-login" class="py-2 px-6 bg-gray-200 rounded btn-animate">Login</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDkCAboSzG3NOWsbHUr0OAqF8S0HoABDe8",
      authDomain: "lifewithdrop.firebaseapp.com",
      projectId: "lifewithdrop",
      storageBucket: "lifewithdrop.firebasestorage.app",
      messagingSenderId: "322887057114",
      appId: "1:322887057114:web:7643dff4f82e71fe93efe3",
      measurementId: "G-9F223GR5ZT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Background slideshow
    const slides = document.querySelectorAll('.bg-slideshow img');
    let index = 0;
    setInterval(() => {
      slides[index].classList.remove('active');
      index = (index + 1) % slides.length;
      slides[index].classList.add('active');
    }, 4000);

    // UI toggles
    const registerForm = document.getElementById('register-form');
    const loginForm = document.getElementById('login-form');
    document.getElementById('show-register').addEventListener('click', () => {
      registerForm.classList.remove('hidden'); loginForm.classList.add('hidden');
    });
    document.getElementById('show-login').addEventListener('click', () => {
      registerForm.classList.add('hidden'); loginForm.classList.remove('hidden');
    });
    document.getElementById('to-login').addEventListener('click', () => {
      registerForm.classList.add('hidden'); loginForm.classList.remove('hidden');
    });
    document.getElementById('to-register').addEventListener('click', () => {
      registerForm.classList.remove('hidden'); loginForm.classList.add('hidden');
    });

    // Load states.json
    let STATES = [];
    fetch('states.json').then(r => r.json()).then(data => {
      STATES = data.states || [];
      const sEl = document.getElementById('register-state');
      STATES.forEach(s => sEl.appendChild(new Option(s.state, s.state)));
      sEl.addEventListener('change', (e) => {
        const selected = STATES.find(x => x.state === e.target.value);
        const dEl = document.getElementById('register-district');
        dEl.innerHTML = '<option value="">Select district</option>';
        (selected?.districts || []).forEach(d => dEl.appendChild(new Option(d, d)));
      });
    });

    // Register
    registerForm.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const name = document.getElementById('register-name').value.trim();
      const contact = document.getElementById('register-contact').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const type = document.getElementById('register-type').value;
      const blood = document.getElementById('register-blood').value;
      const gender = document.getElementById('register-gender').value;
      const dob = document.getElementById('register-dob').value;
      const state = document.getElementById('register-state').value;
      const district = document.getElementById('register-district').value;

      if (!name || !contact || !type || !blood || !state || !district) {
        alert('Please fill required fields.');
        return;
      }
      try {
        const userDocRef = doc(db, 'users', contact);
        const snap = await getDoc(userDocRef);
        if (snap.exists()) {
          alert('Account already exists, please login.');
          loginForm.classList.remove('hidden'); registerForm.classList.add('hidden');
          return;
        }
        const user = { name, contact, email, type, blood, gender, dob, state, district };
        await setDoc(userDocRef, user);
        localStorage.setItem('user', JSON.stringify(user));
        window.location.href = 'main.html';
      } catch (err) {
        console.error(err);
        alert('Registration failed.');
      }
    });

    // Login
    loginForm.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const contact = document.getElementById('login-contact').value.trim();
      if (!contact) return alert('Enter contact.');
      try {
        const docRef = doc(db, 'users', contact);
        const snap = await getDoc(docRef);
        if (!snap.exists()) return alert('No account found.');
        localStorage.setItem('user', JSON.stringify(snap.data()));
        window.location.href = 'main.html';
      } catch (err) {
        console.error(err);
        alert('Login failed.');
      }
    });
  </script>
</body>
</html>
